<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pilot Japanese Dojo</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚úàÔ∏è</text></svg>">
    <style>
        :root {
            /* Airline Theme Colors */
            --primary: #0078D7;
            --primary-dark: #005a9e;
            --accent: #00C851; /* Success Green */
            --bg: #f0f2f5;
            --surface: #ffffff;
            --text-main: #2c3e50;
            --text-sub: #607d8b;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* --- HEADER --- */
        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            width: 100%;
            padding: 1.5rem 0;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        h1 { margin: 0; font-size: 1.6rem; letter-spacing: 1px; }
        .subtitle { font-size: 0.9rem; opacity: 0.9; margin-top: 5px; }

        /* --- NAVIGATION --- */
        nav {
            margin: 20px 0;
            display: flex;
            gap: 8px;
            background: var(--surface);
            padding: 6px;
            border-radius: 50px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        button.nav-btn {
            border: none;
            background: transparent;
            padding: 10px 24px;
            border-radius: 40px;
            cursor: pointer;
            font-weight: 600;
            color: var(--text-sub);
            transition: all 0.2s ease;
        }

        button.nav-btn:hover { background-color: #f8f9fa; }
        button.nav-btn.active {
            background-color: var(--primary);
            color: white;
            box-shadow: 0 2px 8px rgba(0,120,215,0.4);
        }

        /* --- MAIN SECTIONS --- */
        .section { display: none; width: 90%; max-width: 500px; padding-bottom: 60px; animation: slideUp 0.4s ease-out; }
        .section.active { display: block; }

        @keyframes slideUp { 
            from { opacity: 0; transform: translateY(15px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        /* --- COMPONENTS --- */
        .card-box {
            background: var(--surface);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.08);
            text-align: center;
        }

        /* Flashcard Specifics */
        .flashcard-wrapper {
            perspective: 1000px;
            height: 320px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .flashcard {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1);
            transform-style: preserve-3d;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-radius: 20px;
            background: var(--surface);
        }
        .flashcard.flipped { transform: rotateY(180deg); }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 20px;
            padding: 20px;
            box-sizing: border-box;
        }
        .card-front { background: var(--surface); }
        .card-back { transform: rotateY(180deg); background: #f8fbff; border: 2px solid var(--primary); }
        
        .jp-text { font-size: 3.5rem; margin: 0; color: var(--text-main); }
        .kana-text { font-size: 1.2rem; color: var(--text-sub); margin-top: 5px; }
        .en-text { font-size: 2rem; font-weight: bold; color: var(--primary); }
        .romaji-text { font-size: 1rem; color: var(--text-sub); margin-top: 10px; font-style: italic; }

        .btn-control {
            background: var(--text-main);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.2s;
        }
        .btn-control:hover { background: #1a252f; transform: translateY(-2px); }
        .controls { display: flex; justify-content: center; gap: 15px; margin-top: 10px; }

        /* Quiz Specifics */
        .quiz-options { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 25px; }
        .quiz-btn {
            background: #f1f3f5;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.2s;
            color: var(--text-main);
            font-weight: 500;
        }
        .quiz-btn:hover { background: #e9ecef; }
        .quiz-btn.correct { background: var(--accent); color: white; }
        .quiz-btn.wrong { background: #ff4444; color: white; }
        
        .score-pill {
            display: inline-block;
            background: var(--bg);
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: bold;
            color: var(--primary);
            margin-top: 15px;
        }

        /* Settings */
        .settings-group { margin-bottom: 25px; text-align: left; }
        .settings-group h3 { margin-bottom: 10px; font-size: 1.1rem; }
        .input-url {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 0.9rem;
            transition: 0.3s;
        }
        .input-url:focus { border-color: var(--primary); outline: none; }
        .btn-sync { width: 100%; background: var(--primary); margin-top: 10px; }
        .status-msg { margin-top: 10px; font-size: 0.9rem; text-align: center; min-height: 20px; }
        .status-success { color: var(--accent); font-weight: bold; }
        .status-error { color: #ff4444; font-weight: bold; }

    </style>
</head>
<body>

<header>
    <h1>PILOT DOJO</h1>
    <p class="subtitle">Japanese Aviation Vocabulary</p>
</header>

<nav>
    <button class="nav-btn active" onclick="nav('flashcards')">Cards</button>
    <button class="nav-btn" onclick="nav('quiz')">Quiz</button>
    <button class="nav-btn" onclick="nav('settings')">Sync</button>
</nav>

<div id="flashcards" class="section active">
    <div style="text-align:right; margin-bottom:10px; font-size:0.85rem; color:#888;">
        Count: <span id="card-count">0</span>
    </div>
    
    <div class="flashcard-wrapper" onclick="flipCard()">
        <div class="flashcard" id="card-el">
            <div class="card-face card-front">
                <span style="font-size:0.8rem; color:#aaa; text-transform:uppercase; letter-spacing:1px; margin-bottom:20px;">Term</span>
                <h2 class="jp-text" id="fc-jp">...</h2>
                <p class="kana-text" id="fc-kana">Loading...</p>
                <div style="margin-top:40px; font-size:0.8rem; color:#ccc;">Tap to flip</div>
            </div>
            <div class="card-face card-back">
                <span style="font-size:0.8rem; color:#aaa; text-transform:uppercase; letter-spacing:1px; margin-bottom:20px;">Meaning</span>
                <div class="en-text" id="fc-en">...</div>
                <div class="romaji-text" id="fc-romaji">...</div>
            </div>
        </div>
    </div>

    <div class="controls">
        <button class="btn-control" onclick="moveCard(-1)">‚Üê Prev</button>
        <button class="btn-control" onclick="moveCard(1)">Next ‚Üí</button>
    </div>
</div>

<div id="quiz" class="section">
    <div class="card-box">
        <p style="color:#888; margin-bottom:5px;">What does this mean?</p>
        <h2 style="font-size:2.5rem; margin:10px 0; color:var(--primary);" id="q-jp">...</h2>
        
        <div class="quiz-options" id="q-options">
            </div>

        <div class="score-pill" id="score-display">Score: 0</div>
        
        <button id="next-q-btn" class="btn-control" style="width:100%; margin-top:20px; background:var(--accent); display:none;" onclick="initQuiz()">Next Question</button>
    </div>
</div>

<div id="settings" class="section">
    <div class="card-box">
        <div class="settings-group">
            <h3>‚òÅÔ∏è Google Sheets Sync</h3>
            <p style="font-size:0.85rem; color:#666; margin-bottom:10px;">
                Paste your Web App URL below to sync vocabulary.
            </p>
            <input type="text" id="api-url" class="input-url" placeholder="https://script.google.com/macros/s/..." onchange="saveUrl()">
            <button class="btn-control btn-sync" onclick="fetchData()">Sync Now</button>
            <div id="sync-status" class="status-msg"></div>
        </div>

        <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">

        <div class="settings-group">
            <h3>üíæ Backup Data</h3>
            <div style="display:flex; gap:10px;">
                <button class="quiz-btn" style="flex:1; padding:10px;" onclick="exportJson()">Export JSON</button>
                <button class="quiz-btn" style="flex:1; padding:10px;" onclick="document.getElementById('file-in').click()">Import JSON</button>
            </div>
            <input type="file" id="file-in" style="display:none" accept=".json" onchange="importJson(this)">
        </div>
    </div>
    
    <div style="margin-top:20px; text-align:center; font-size:0.8rem; color:#aaa;">
        Pilot Dojo v2.0
    </div>
</div>

<script>
    // --- STATE MANAGEMENT ---
    let vocab = [];
    let curIdx = 0;
    let score = 0;
    let currentQ = null;

    // Load saved data on startup
    window.onload = () => {
        const savedVocab = localStorage.getItem('pilot_vocab');
        const savedUrl = localStorage.getItem('pilot_url');
        
        if (savedUrl) document.getElementById('api-url').value = savedUrl;
        
        if (savedVocab) {
            vocab = JSON.parse(savedVocab);
        } else {
            // Default starter data (Aviation Themed)
            vocab = [
                { jp: 'ÊªëËµ∞Ë∑Ø', kana: '„Åã„Å£„Åù„ÅÜ„Çç', en: 'Runway', romaji: 'Kassouro' },
                { jp: 'Èõ¢Èô∏', kana: '„Çä„Çä„Åè', en: 'Takeoff', romaji: 'Ririku' },
                { jp: 'ÁùÄÈô∏', kana: '„Å°„ÇÉ„Åè„Çä„Åè', en: 'Landing', romaji: 'Chakuriku' },
                { jp: 'ÁÆ°Âà∂Â°î', kana: '„Åã„Çì„Åõ„ÅÑ„Å®„ÅÜ', en: 'Control Tower', romaji: 'Kanseitou' }
            ];
        }
        updateUI();
    };

    // --- NAVIGATION ---
    function nav(id) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        
        if (id === 'flashcards') updateCard();
        if (id === 'quiz') initQuiz();
    }

    // --- FLASHCARDS ---
    function updateUI() {
        document.getElementById('card-count').innerText = vocab.length;
        updateCard();
    }

    function updateCard() {
        if (vocab.length === 0) return;
        const item = vocab[curIdx];
        document.getElementById('fc-jp').innerText = item.jp;
        document.getElementById('fc-kana').innerText = item.kana;
        document.getElementById('fc-en').innerText = item.en;
        document.getElementById('fc-romaji').innerText = item.romaji;
        document.getElementById('card-el').classList.remove('flipped');
    }

    function flipCard() {
        document.getElementById('card-el').classList.toggle('flipped');
    }

    function moveCard(dir) {
        curIdx = (curIdx + dir + vocab.length) % vocab.length;
        updateCard();
    }

    // --- QUIZ LOGIC ---
    function initQuiz() {
        if (vocab.length < 4) {
            document.getElementById('q-jp').innerText = "Need more words!";
            document.getElementById('q-options').innerHTML = "<small>Add at least 4 words in Settings.</small>";
            return;
        }
        
        document.getElementById('next-q-btn').style.display = 'none';
        
        // Pick question
        const qIdx = Math.floor(Math.random() * vocab.length);
        currentQ = vocab[qIdx];
        document.getElementById('q-jp').innerText = currentQ.jp;

        // Pick distractors
        let opts = [currentQ];
        while(opts.length < 4) {
            let r = vocab[Math.floor(Math.random() * vocab.length)];
            if (!opts.includes(r)) opts.push(r);
        }
        // Shuffle
        opts.sort(() => Math.random() - 0.5);

        // Render
        const container = document.getElementById('q-options');
        container.innerHTML = '';
        opts.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'quiz-btn';
            btn.innerText = opt.en;
            btn.onclick = (e) => handleAnswer(opt, e.target);
            container.appendChild(btn);
        });
    }

    function handleAnswer(selected, btn) {
        // Disable all
        document.querySelectorAll('.quiz-btn').forEach(b => b.disabled = true);
        
        if (selected.jp === currentQ.jp) {
            btn.classList.add('correct');
            score += 10;
            document.getElementById('score-display').innerText = `Score: ${score}`;
        } else {
            btn.classList.add('wrong');
            // Highlight correct
            document.querySelectorAll('.quiz-btn').forEach(b => {
                if (b.innerText === currentQ.en) b.classList.add('correct');
            });
        }
        document.getElementById('next-q-btn').style.display = 'block';
    }

    // --- SYNC & DATA ---
    function saveUrl() {
        localStorage.setItem('pilot_url', document.getElementById('api-url').value);
    }

    async function fetchData() {
        const url = document.getElementById('api-url').value;
        const status = document.getElementById('sync-status');
        
        if (!url) {
            status.innerText = "Please enter a URL first.";
            return;
        }

        status.innerText = "Connecting to Google...";
        status.className = "status-msg";

        try {
            const res = await fetch(url);
            const data = await res.json();
            
            if (data.error) throw new Error(data.error);
            if (!Array.isArray(data)) throw new Error("Invalid data format");

            vocab = data;
            localStorage.setItem('pilot_vocab', JSON.stringify(vocab));
            curIdx = 0;
            updateUI();
            
            status.innerText = `Success! Loaded ${vocab.length} words.`;
            status.className = "status-msg status-success";
        } catch (err) {
            console.error(err);
            status.innerText = "Sync Failed. Check URL & permissions.";
            status.className = "status-msg status-error";
        }
    }

    function exportJson() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(vocab, null, 2));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "pilot_vocab.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }

    function importJson(input) {
        const file = input.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                vocab = JSON.parse(e.target.result);
                localStorage.setItem('pilot_vocab', JSON.stringify(vocab));
                updateUI();
                alert("Imported successfully!");
            } catch (err) { alert("Invalid file"); }
        };
        reader.readAsText(file);
    }
</script>

</body>
</html>
